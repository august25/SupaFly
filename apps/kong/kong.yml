_format_version: '1.1'

###
### Consumers / Users
###
consumers:
- username: anon
  keyauth_credentials:
    - key: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwianRpIjoiOWNiNzMxNDQtNDdmOC00NTgxLWFiOTMtMzI2OTZlMTk2YmE4IiwiaWF0IjoxNjgzNTcyNDM5LCJleHAiOjE2ODM1NzYwMzl9.UkcuVxWYMNKyckolonKN-OGDYqV9BQmlIReJJwBaSxs
- username: service_role
  keyauth_credentials:
    - key: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoic2VydmljZV9yb2xlIiwiaXNzIjoic3VwYWJhc2UiLCJqdGkiOiJjYjVjYTdiNS0wMWEzLTQxM2YtODNlMS0zNjk2NzlhNGZjYWEiLCJpYXQiOjE2ODM1NzI0MzksImV4cCI6MTY4MzU3NjAzOX0.MhnIit_RdAOzZdm7KATpN62G28GlOD2fq73LqDKE54Q

###
### Access Control List
###
acls:
- consumer: anon
  group: anon
- consumer: service_role
  group: admin

###
### API Routes
###
services:
## Open Auth routes
- name: test
  url: https://kongtest.nick-prim.workers.dev/
  routes:
    - name: test
      strip_path: true
      paths:
        - /test
  plugins:
    - name: cors
- name: auth-v1-open
  host: "[fdaa:2:21ef:a7b:c850:827e:f9d8:2]"
  port: 9999
  routes:
    - name: auth-v1-open
      strip_path: true
      paths:
        - /auth/v1/verify
  plugins:
    - name: cors
- name: auth-v1-open-callback
  host: "[fdaa:2:21ef:a7b:c850:827e:f9d8:2]"
  port: 9999
  routes:
    - name: auth-v1-open-callback
      strip_path: true
      paths:
        - /auth/v1/callback
  plugins:
    - name: cors
- name: auth-v1-open-authorize
  host: "[fdaa:2:21ef:a7b:c850:827e:f9d8:2]"
  port: 9999
  routes:
    - name: auth-v1-open-authorize
      strip_path: true
      paths:
        - /auth/v1/authorize
  plugins:
    - name: cors

## Secure Auth routes
- name: auth-v1
  host: "[fdaa:2:21ef:a7b:c850:827e:f9d8:2]"
  port: 9999
  routes:
    - name: auth-v1-all
      strip_path: true
      paths:
        - /auth/v1/
  plugins:
    - name: cors
    - name: key-auth
      config:
        hide_credentials: false
    - name: acl
      config:
        hide_groups_header: true
        allow:
          - admin
          - anon

## Secure REST routes
- name: rest-v1
  host: "red-wind-293.fly.dev"
  port: 3000
  routes:
    - name: rest-v1-all
      strip_path: true
      paths:
        - /rest/v1/
  plugins:
    - name: cors
    - name: key-auth
      config:
        hide_credentials: true
    - name: acl
      config:
        hide_groups_header: true
        allow:
          - admin
          - anon
## Secure Database routes
- name: meta
  host: "[fdaa:2:21ef:a7b:104:d904:536b:2]"
  port: 8080
  routes:
    - name: meta-all
      strip_path: true
      paths:
        - /pg/

  