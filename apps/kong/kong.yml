_format_version: '1.1'

###
### Consumers / Users
###
consumers:
- username: anon
  keyauth_credentials:
    - key: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoiYW5vbiIsImlzcyI6InN1cGFiYXNlIiwianRpIjoiM2U4ZDA4NzAtYjQ1ZS00YmM5LWJjY2UtODgzMjgzZGUyNGFhIiwiaWF0IjoxNjgzNTk4NDA2LCJleHAiOjE2ODM2MDIwMDZ9.XqmEAo5AEGI3yjhdNuC-gBlk6isITYE0mu5yTrG0cBg
- username: service_role
  keyauth_credentials:
    - key: eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJyb2xlIjoic2VydmljZV9yb2xlIiwiaXNzIjoic3VwYWJhc2UiLCJqdGkiOiIxM2VkMGJlZC1iNjE5LTQ3NjctOGMyNy00NDZiNWYzMWYxODAiLCJpYXQiOjE2ODM1OTg0MDYsImV4cCI6MTY4MzYwMjAwNn0.qKZmcXb1dCKSWqNuQKoKmkyzqWneL_Z41S9VIP2REWg

###
### Access Control List
###
acls:
- consumer: anon
  group: anon
- consumer: service_role
  group: admin

###
### API Routes
###
services:
## Open Auth routes
- name: test
  url: https://kongtest.nick-prim.workers.dev/
  routes:
    - name: test
      strip_path: true
      paths:
        - /test
  plugins:
    - name: cors
- name: auth-v1-open
  host: "[fdaa:2:21ef:a7b:f8:1b7f:54c5:2]"
  port: 9999
  routes:
    - name: auth-v1-open
      strip_path: true
      paths:
        - /auth/v1/verify
  plugins:
    - name: cors
- name: auth-v1-open-callback
  host: "[fdaa:2:21ef:a7b:f8:1b7f:54c5:2]"
  port: 9999
  routes:
    - name: auth-v1-open-callback
      strip_path: true
      paths:
        - /auth/v1/callback
  plugins:
    - name: cors
- name: auth-v1-open-authorize
  host: "[fdaa:2:21ef:a7b:f8:1b7f:54c5:2]"
  port: 9999
  routes:
    - name: auth-v1-open-authorize
      strip_path: true
      paths:
        - /auth/v1/authorize
  plugins:
    - name: cors

## Secure Auth routes
- name: auth-v1
  host: "[fdaa:2:21ef:a7b:f8:1b7f:54c5:2]"
  port: 9999
  routes:
    - name: auth-v1-all
      strip_path: true
      paths:
        - /auth/v1/
  plugins:
    - name: cors
    - name: key-auth
      config:
        hide_credentials: false
    - name: acl
      config:
        hide_groups_header: true
        allow:
          - admin
          - anon

## Secure REST routes
- name: rest-v1
  url: "https://falling-meadow-2024.fly.dev/"
  routes:
    - name: rest-v1-all
      strip_path: true
      paths:
        - /rest/v1/
  plugins:
    - name: cors
    - name: key-auth
      config:
        hide_credentials: true
    - name: acl
      config:
        hide_groups_header: true
        allow:
          - admin
          - anon
## Secure Database routes
- name: meta
  host: "[fdaa:2:21ef:a7b:104:fad1:d2b4:2]"
  port: 8080
  routes:
    - name: meta-all
      strip_path: true
      paths:
        - /pg/

  